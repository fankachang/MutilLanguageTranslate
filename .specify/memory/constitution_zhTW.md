# TAIDE 翻譯系統憲章

## 核心原則

### I. 離線優先架構
所有系統組件必須在完全隔離的內網環境中運作，無需外部網際網路連線。這包括：
- 模型部署：所有 AI 模型必須可在本地部署，無需外部 API 呼叫
- 依賴管理：所有依賴（函式庫、框架、靜態資源）必須離線可用
- 自給自足：不依賴外部 CDN、雲端服務或遠端資源

### II. 效能即特性
翻譯效能是核心使用者體驗指標，而非可選項：
- GPU 模式：目標 2-3 秒完成 1000 字元翻譯（95th percentile）
- CPU 模式：目標 8-10 秒完成 1000 字元翻譯（95th percentile）
- 並發能力：支援 100 個並發使用者而不降級服務品質
- 所有架構決策必須考慮效能影響並提供理由

### III. 簡潔與務實（不可協商）
避免過度工程。除非複雜度有充分理由，否則選擇更簡單的方案：
- YAGNI 原則：「You Aren't Gonna Need It」— 在需要時才實作功能，而非推測性實作
- 優先使用 Django 內建功能，避免功能重疊的第三方函式庫
- 避免重型框架（React/Vue），當輕量級替代方案（HTMX/Alpine.js）足以勝任時
- 質疑每個新依賴：「我們能用現有工具達成嗎？」

### IV. 測試驅動開發
測試是強制性的，而非可選：
- 單元測試：所有業務邏輯必須有單元測試覆蓋
- 整合測試：API 契約必須通過整合測試驗證
- 效能測試：並發宣稱（100+ 使用者）需要負載測試
- 測試結構：tests/unit/、tests/integration/、tests/performance/

### V. 可觀測性與可維護性
系統必須在生產環境中可除錯與可維護：
- 結構化日誌：三級日誌（ERROR/WARNING/INFO），保留 30 天
- 監控：系統狀態 API 公開資源使用率、錯誤統計、並發指標
- 健康檢查：/api/health 端點供監控工具使用
- 錯誤上下文：所有錯誤必須包含可操作的資訊（request_id、error_code、建議解決方案）

### VI. 配置優於程式碼
配置必須外部化且針對環境：
- 基於 YAML 的配置：config/app_config.yaml、config/model_config.yaml、config/languages.yaml
- 無硬編碼值：資源限制、超時、路徑必須可配置
- 合理預設值：系統必須在最小配置下即可運作
- 文件化：所有配置選項必須在 quickstart.md 中記錄

### VII. API 優先設計
公開介面（API）是契約，必須保持穩定：
- RESTful 原則：遵循 REST 慣例（HTTP 方法、狀態碼、資源命名）
- Schema 驗證：所有請求/回應格式必須明確定義
- 錯誤一致性：所有端點使用標準化的錯誤代碼與格式
- 向後相容性：破壞性變更需要主版本升級與遷移指南

## 額外約束

### 技術棧需求
- **語言**：Python 3.11+（不支援 Python 2.x，強制最低版本）
- **框架**：Django 4.2+ 支援 ASGI
- **AI 模型**：TAIDE-LX-7B-Chat（僅本地部署）
- **前端**：優先使用伺服器渲染模板，避免 SPA（單頁應用程式）
- **資料庫**：除非有充分理由，避免傳統資料庫（PostgreSQL/MySQL）；任務佇列僅使用 SQLite

### 安全需求
- **身份驗證**：內網部署不需要，但系統必須為未來整合身份驗證做好準備
- **輸入驗證**：所有使用者輸入必須在伺服器端驗證（絕不僅信任客戶端驗證）
- **限流**：即使在內網環境也要防止濫用（基於 IP 的限流）
- **檔案上傳**：批量翻譯上傳需嚴格驗證檔案類型與大小

### 部署約束
- **內網環境**：系統必須在無網際網路存取的環境中部署與運作
- **單伺服器**：初始設計針對單伺服器部署（無分散式系統）
- **資源隔離**：GPU 記憶體必須限制以防止 OOM 錯誤（最多 0.8 比例）
- **優雅降級**：若 GPU 不可用，系統必須自動退回 CPU 模式

## 開發工作流程

### 程式碼審查需求
- **先自我審查**：作者在請求同儕審查前必須先審查自己的程式碼
- **憲章符合性**：審查者必須驗證變更符合所有原則
- **測試覆蓋率**：新功能需要對應的測試（無測試的程式碼不可接受）
- **文件更新**：影響 API 或配置的變更必須更新相關文件

### Git 提交標準
- **語言**：所有 commit 訊息、程式碼註解、文件必須使用繁體中文（zh-TW）
- **格式**：遵循 Conventional Commits 規範（feat/fix/docs/refactor/test）
- **範圍**：包含功能分支前綴（例如「feat(001-taide-translation): 新增即時翻譯 API」）
- **主體**：解釋「為什麼」，而非僅「做什麼」（在相關時連結到 spec.md 或 issue）

### 測試門檻
- **提交前**：單元測試必須在本地通過才能提交
- **推送前**：所有測試（單元 + 整合）必須通過才能推送
- **部署前**：效能測試必須在生產部署前驗證並發目標
- **回歸**：破壞性變更需要明確批准與遷移文件

## 治理

### 憲章權威
- 本憲章凌駕於所有其他開發實踐與指南之上
- 當便利性與憲章衝突時，憲章優先
- 例外情況需要明確文件化並達成團隊共識

### 修正流程
- 修正需要在 constitution.md 中記錄並說明理由
- 對原則的破壞性變更需要現有程式碼的遷移計畫
- 每次變更必須更新版本與修正日期

### 複雜度正當化
- 任何違反「簡潔與務實」的架構決策必須在 plan.md 的「Complexity Tracking」中記錄
- 正當化必須包含：(1) 為何需要，(2) 為何拒絕更簡單的替代方案
- 範例：新增第 4 個微服務、當直接資料庫存取足夠時使用 Repository 模式

### 執行
- 所有程式碼審查必須驗證憲章符合性
- CI/CD 管線應自動化可能的憲章檢查（linting、測試覆蓋率）
- 參考 [AGENTS.md](../../AGENTS.md) 取得特定 Agent 的開發指南

**版本**：1.0.0 | **批准日期**：2026-01-08 | **最後修正**：2026-01-08
