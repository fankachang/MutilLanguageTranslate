# 多國語言翻譯系統 - 功能規格書
**版本**: 1.0  
**日期**: 2026年1月11日  
**目標**: .NET 實作參考規格

---

## 一、系統概述

### 1.1 系統目標
開發一個內網多國語言翻譯系統，供員工快速進行文字翻譯，支援多種語言互譯。系統部署於內網環境，員工透過瀏覽器訪問使用。

### 1.2 使用情境
- 員工需要翻譯文件內容以便與國際團隊溝通
- 處理多種語言組合（中、英、日、韓、法、德、西班牙文）
- 需要快速、準確的翻譯結果
- 無需帳號登入，直接使用

---

## 二、核心功能需求

### 2.1 基本翻譯功能（優先級：P1 - 必須）

#### 功能描述
- 使用者輸入原文文字
- 選擇目標語言
- 點擊翻譯按鈕
- 顯示翻譯結果
- 可複製翻譯結果到剪貼簿

#### 業務規則
1. **文字長度**：單次翻譯最多支援 10,000 字元
2. **格式保留**：保留原文的段落換行格式
3. **空白處理**：正確處理多餘空白和特殊字元

#### 驗收標準
```
情境1：基本文字翻譯
- 輸入：「我需要將這份報告翻譯成英文」
- 選擇目標語言：英文
- 期望：顯示英文翻譯結果
- 驗證：可成功複製結果

情境2：多段落翻譯
- 輸入：包含3個段落的文字（有換行）
- 期望：翻譯結果保留段落格式

情境3：特殊字元處理
- 輸入：包含表情符號、標點符號的文字
- 期望：正確處理不影響翻譯品質
```

---

### 2.2 多語言支援（優先級：P1 - 必須）

#### 支援語言清單
1. 繁體中文（zh-TW）
2. 簡體中文（zh-CN）
3. 英文（en）
4. 日文（ja）
5. 韓文（ko）
6. 法文（fr）
7. 德文（de）
8. 西班牙文（es）

#### 功能特性
- **雙向翻譯**：任意兩種語言間可互相翻譯
- **自動檢測**：可選「自動偵測」來源語言
- **語言交換**：提供快速交換來源語言與目標語言的功能
- **預設語言**：系統預設目標語言為繁體中文

#### 驗收標準
```
情境1：非中英語言對翻譯
- 來源語言：日文
- 目標語言：韓文
- 期望：系統能正確翻譯

情境2：自動語言偵測
- 輸入：日文文字
- 選擇：自動偵測
- 期望：系統識別為日文並完成翻譯

情境3：語言交換
- 當前：中文→英文
- 點擊「交換」按鈕
- 期望：變更為英文→中文，譯文自動成為原文
```

---

### 2.3 使用者設定（優先級：P2 - 重要）

#### 可調整設定項目
1. **翻譯品質**
   - 快速模式：速度優先，品質中等
   - 標準模式：速度與品質平衡（預設）
   - 高品質模式：品質優先，速度較慢

2. **介面主題**
   - 亮色模式（預設）
   - 暗色模式

3. **顯示設定**
   - 字體大小：小、中（預設）、大
   - 常用語言組合記憶

#### 資料儲存
- **儲存位置**：瀏覽器會話儲存（sessionStorage）
- **持久性**：會話期間有效，關閉標籤頁後清除
- **範圍**：當前標籤頁/會話，不跨分頁或裝置

#### 驗收標準
```
情境1：品質調整
- 設定高品質模式
- 執行翻譯
- 期望：結果更準確（速度可能較慢）

情境2：會話內設定保留
- 調整主題為暗色、字體為大
- 重新整理頁面（不關閉標籤頁）
- 期望：設定保持不變

情境3：會話結束後重設
- 調整主題為暗色
- 關閉標籤頁
- 重新開啟新標籤頁
- 期望：設定恢復為預設值
```

---

### 2.4 翻譯歷史記錄（優先級：P2 - 重要）

#### 功能描述
- 記錄當前瀏覽器會話的翻譯歷史
- 顯示最近 20 筆翻譯記錄
- 可點擊歷史記錄快速重現
- 關閉瀏覽器標籤頁後原則上自動清除（以 sessionStorage 行為為準）

#### 記錄內容
- 原文（前 50 字元預覽）
- 譯文（前 50 字元預覽）
- 來源語言
- 目標語言
- 翻譯時間戳

#### 業務規則
1. **記錄上限**：最多保留 20 筆
2. **清除時機**：標籤頁關閉時原則上自動清除（以 sessionStorage 行為為準）
3. **儲存位置**：sessionStorage（會話級別）

---

### 2.5 錯誤處理與使用者提示（優先級：P1 - 必須）

#### 錯誤類型與處理

1. **輸入驗證錯誤**
   - 空白輸入：提示「請輸入要翻譯的文字」
   - 超過字數限制：提示「文字長度超過 10,000 字元，請縮短後再試」
   - 無效字元：靜默過濾，不中斷翻譯

2. **語言選擇錯誤**
   - 來源與目標相同：禁用翻譯按鈕，提示「來源語言與目標語言不可相同」

3. **系統錯誤**
   - 翻譯服務無回應：顯示「翻譯服務暫時無法使用，請稍後再試」
   - 網路連線問題：顯示「網路連線失敗，請檢查網路狀態」
   - 翻譯逾時（閾值可配置）：顯示「翻譯逾時，請嘗試縮短文字長度或稍後再試」

4. **使用者體驗**
   - 所有錯誤訊息以中文顯示
   - 提供明確的解決建議
   - 錯誤訊息可手動關閉

---

## 三、非功能性需求

### 3.1 效能需求
- **並發處理**：支援最多 100 個同時翻譯請求
- **佇列機制**：超過 100 個並發時進入等待佇列（佇列上限 100）
- **拒絕策略**：總請求數超過 200 時拒絕新請求並返回錯誤訊息

補充說明：
- 本規格不定義翻譯完成時間（取決於硬體與模型）。
- 如有佇列等待，應在回應或 UI 中清楚區分「等待中」與「處理中」。

### 3.2 可用性需求
- **瀏覽器相容性**：支援 Chrome、Edge、Firefox、Safari 最新版本
- **響應式設計**：支援桌面（1920x1080）、筆電（1366x768）、平板（1024x768）
- **無障礙性**：符合基本鍵盤操作需求（Tab 導航、Enter 執行）

### 3.3 安全性需求
- **輸入清理**：
  - 防止 XSS 攻擊（跨站腳本攻擊）
  - 防止 SQL 注入攻擊
  - 惡意腳本檢測

- **存取控制**：
  - 限內網 IP 範圍存取
  - 不需要使用者驗證
  - 開發階段可使用 HTTP 進行驗證；正式部署於 IIS 時需同時支援 HTTP/HTTPS（依內網政策啟用）

### 3.4 維運需求

#### 日誌記錄

- **系統日誌（System Log）**
  - **日誌等級**：ERROR、WARNING、INFO
  - **用途**：系統維運、錯誤追蹤與除錯
  - **記錄內容**（必須）：
    - 所有程式錯誤/例外（前端、後端，含錯誤類型、時間戳、堆疊追蹤、來源）
    - 翻譯請求記錄（來源語言、目標語言、字數、處理時間、結果狀態、是否排隊）
  - **記錄內容**（選配）：
    - 模型載入流程與進度
    - 系統效能指標（記憶體使用、CPU 使用率、請求數）
  - **保留期限**：30 天（可配置）
  - **儲存位置**：伺服器本地檔案系統（log file）
  - **顯示原則**：介面原則上只顯示錯誤訊息；若需要呈現模型載入進度等狀態，才額外顯示對應進度訊息

- **使用者會話狀態（非日誌）**
  - **用途**：保存使用者本次會話的操作偏好與選擇
  - **儲存內容**：
    - 翻譯語言選擇（來源語言、目標語言）
    - 介面設定（主題：亮色/暗色、字體大小、翻譯品質）
    - 翻譯歷史記錄（最近 20 筆，詳見 2.4）
  - **保留期限**：會話期間（關閉標籤頁後清除）
  - **儲存位置**：瀏覽器 sessionStorage

#### 系統監控
提供系統狀態監控頁面，顯示：
- 系統執行狀態（運行中/停止）
- 當前並發請求數
- 記憶體使用量
- CPU 使用率
- 翻譯模型狀態（已載入/未載入）
- 近 24 小時翻譯請求統計

---

## 四、使用者介面需求

### 4.1 主翻譯頁面

#### 佈局結構
```
+--------------------------------------------------+
|  [LOGO] 多國語言翻譯系統        [設定] [系統狀態] |
+--------------------------------------------------+
|  來源語言  [自動偵測 ▼]    ⇄    目標語言 [繁體中文 ▼] |
+--------------------------------------------------+
| 原文                                              |
| +----------------------------------------------+ |
| |                                              | |
| |  [輸入或貼上要翻譯的文字...]                    | |
| |                                              | |
| |                                              | |
| +----------------------------------------------+ |
| 12 / 10,000 字元                    [清除]       |
+--------------------------------------------------+
|                 [✨ 翻譯]                        |
+--------------------------------------------------+
| 譯文                                              |
| +----------------------------------------------+ |
| |  [翻譯結果將顯示在這裡]                         | |
| |                                              | |
| |                                              | |
| +----------------------------------------------+ |
|                                     [📋 複製結果]  |
+--------------------------------------------------+
| 翻譯資訊：                                        |
| • 偵測到的語言：英文（僅來源語言=自動偵測時顯示） |
| • 處理時間：3.2 秒（選配顯示）                    |
| • 執行模式：GPU                                  |
+--------------------------------------------------+
```

#### 互動行為
1. **即時字數統計**：輸入時即時更新字數
2. **按鈕狀態**：
   - 無輸入文字時：翻譯按鈕禁用
   - 翻譯進行中：按鈕顯示「翻譯中...」並禁用
   - 來源=目標語言：翻譯按鈕禁用

3. **載入指示**：
   - 翻譯進行中顯示載入動畫
   - 若進入佇列，顯示「等待中」狀態（可選擇顯示佇列資訊）

4. **快捷鍵**：
   - Ctrl+Enter：執行翻譯
   - 複製譯文：提供「複製結果」按鈕，點擊後複製整個譯文內容

### 4.2 設定頁面

#### 設定項目
```
+--------------------------------------------------+
|  系統設定                                         |
+--------------------------------------------------+
|  翻譯品質                                         |
|  ○ 快速  ○ 標準（預設） ○ 高品質                  |
|                                                  |
|  介面主題                                         |
|  ○ 亮色（預設） ○ 暗色                            |
|                                                  |
|  字體大小                                         |
|  ○ 小  ○ 中（預設） ○ 大                          |
|                                                  |
|  [儲存設定]  [重設為預設值]                       |
+--------------------------------------------------+
```

### 4.3 系統狀態頁面

#### 顯示資訊
```
+--------------------------------------------------+
|  系統狀態監控                                     |
+--------------------------------------------------+
|  系統狀態：          🟢 運行中                    |
|  翻譯模型：          ✅ 已載入                    |
|  執行模式：          GPU                         |
|  當前並發請求：      12 / 100                    |
|  記憶體使用：        4.2 GB / 16 GB (26%)        |
|  CPU 使用率：        35%                         |
+--------------------------------------------------+
|  近 24 小時統計                                   |
|  • 總翻譯請求：      1,245 次                    |
|  • 成功翻譯：        1,238 次 (99.4%)            |
|  • 失敗翻譯：        7 次 (0.6%)                 |
|  • 平均處理時間：    3.8 秒                      |
+--------------------------------------------------+
```

---

## 五、資料結構定義

### 5.1 語言定義
```
語言物件：
{
  code: string          // 語言代碼 (例如: "zh-TW", "en", "ja")
  name: string          // 本地語言名稱 (例如: "繁體中文", "日本語")
  name_en: string       // 英文名稱 (例如: "Traditional Chinese")
  enabled: boolean      // 是否啟用
}
```

### 5.2 翻譯請求
```
翻譯請求物件：
{
  text: string              // 原文內容 (1-10,000 字元)
  source_lang: string       // 來源語言代碼 (或 "auto")
  target_lang: string       // 目標語言代碼
  quality: string           // 品質設定: "fast" | "standard" | "high"
}
```

### 5.3 翻譯回應
```
翻譯回應物件：
{
  status: string            // "success" | "error"
  translation: string       // 翻譯結果文字
  detected_language: string // 偵測到的來源語言 (若使用自動偵測)
  processing_time: number   // 處理時間（秒，選配）
  execution_mode: string    // "gpu" | "cpu"
  error_message: string     // 錯誤訊息 (僅在 status="error" 時)
}
```

### 5.4 使用者設定
```
使用者設定物件：
{
  quality: string           // "fast" | "standard" | "high"
  theme: string            // "light" | "dark"
  fontSize: string         // "small" | "medium" | "large"
  sourceLang: string       // 最近使用的來源語言代碼
  targetLang: string       // 最近使用的目標語言代碼
}
```

### 5.5 翻譯歷史
```
歷史記錄物件：
{
  id: number                    // 唯一識別碼 (時間戳)
  original_text: string         // 原文預覽 (前 50 字元)
  translated_text: string       // 譯文預覽 (前 50 字元)
  source_lang: string          // 來源語言代碼
  target_lang: string          // 目標語言代碼
  timestamp: string            // ISO 8601 時間戳
}
```

---

## 六、API 端點定義（技術無關）

### 6.1 翻譯 API
- **目的**：執行文字翻譯
- **輸入**：翻譯請求物件
- **輸出**：翻譯回應物件
- **錯誤處理**：
  - 輸入驗證失敗：返回錯誤訊息
  - 翻譯服務異常：返回錯誤訊息與錯誤碼
  - 超時：返回超時錯誤

### 6.2 語言列表 API
- **目的**：取得系統支援的語言清單
- **輸入**：無
- **輸出**：語言物件陣列
- **包含**：自動偵測選項

### 6.3 語言偵測 API
- **目的**：偵測給定文字的語言
- **輸入**：文字字串
- **輸出**：語言代碼 + 信心分數 (0-1)
- **回退策略**：信心分數 < 0.5 時回退為預設語言（繁體中文）

### 6.4 系統狀態 API
- **目的**：取得系統當前狀態
- **輸入**：無
- **輸出**：系統狀態物件
- **包含**：
  - 系統運行狀態
  - 資源使用情況
  - 翻譯統計資訊

---

## 七、部署與維運規範

### 7.1 部署環境
- **網路**：內網環境，限制 IP 範圍存取
- **伺服器**：Windows Server 或 Linux Server
- **資源建議**：
  - CPU：8 核心以上
  - RAM：16GB 以上
  - 儲存：50GB 以上（含模型檔案）
  - GPU：選配（NVIDIA GPU 可大幅提升效能）

### 7.2 啟動與停止
- **自動啟動**：系統可設定為開機自動啟動服務
- **優雅停止**：支援正常關閉，完成進行中的翻譯請求後才停止
- **健康檢查**：提供健康檢查端點供監控工具使用

### 7.3 資料備份
- **無狀態設計**：系統為無狀態服務
- **需備份項目**：
  - 系統配置檔案
  - 日誌檔案（選配）
- **不需備份**：翻譯歷史（會話級別，自動清除）

### 7.4 故障處理
- **自動重啟**：系統異常崩潰時可自動重啟
- **降級模式**：GPU 不可用時自動切換到 CPU 模式
- **請求重試**：暫時性錯誤支援自動重試（最多 3 次）

---

## 八、未來擴充規劃（V2.0）

### 8.1 進階功能
- **批量翻譯**：上傳檔案批量處理（.txt, .docx, .csv）
- **術語庫管理**：自訂專業術語翻譯對照
- **翻譯記憶**：重複內容直接使用快取結果

### 8.2 整合需求
- **API 整合**：提供 REST API 供其他系統呼叫
- **單一登入 (SSO)**：與企業身分驗證系統整合
- **審核日誌**：記錄詳細使用者操作日誌

### 8.3 效能優化
- **分散式部署**：支援多伺服器負載平衡
- **快取機制**：常用翻譯結果快取
- **CDN 整合**：靜態資源 CDN 加速

---

## 附錄 A：術語對照表

| 中文術語 | 英文術語 | 說明 |
|---------|---------|------|
| 來源語言 | Source Language | 原文的語言 |
| 目標語言 | Target Language | 翻譯結果的語言 |
| 自動偵測 | Auto Detect | 系統自動識別原文語言 |
| 翻譯品質 | Translation Quality | 翻譯的速度與準確度權衡 |
| 並發請求 | Concurrent Requests | 同時處理的翻譯請求數量 |
| 佇列機制 | Queue Mechanism | 超過並發上限時的等待處理機制 |
| 會話儲存 | Session Storage | 瀏覽器會話級別的資料儲存 |
| 系統日誌 | System Log | 伺服器端程式錯誤與請求記錄 |

---

## 附錄 B：變更歷史

| 版本 | 日期 | 變更內容 | 負責人 |
|-----|------|---------|-------|
| 1.0 | 2026-01-11 | 初始版本建立 | - |

---

**文件結束**
