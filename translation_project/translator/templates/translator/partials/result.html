{# 
ç¿»è­¯çµæœç‰‡æ®µ - ç”¨æ–¼ HTMX éƒ¨åˆ†æ›´æ–°
Translation result partial - for HTMX partial updates
#}

{% if status == 'completed' %}
<div class="translation-result success" id="translation-result">
    <div class="result-header">
        <span class="status-badge status-completed">âœ“ ç¿»è­¯å®Œæˆ</span>
        {% if detected_language %}
        <span class="detected-info">
            åµæ¸¬èªè¨€ï¼š<strong>{{ detected_language_name }}</strong>
            {% if confidence_score %}
            <span class="confidence">({{ confidence_percent }}% ä¿¡å¿ƒåº¦)</span>
            {% endif %}
        </span>
        {% endif %}
    </div>
    
    <div class="result-content">
        <pre class="translated-text">{{ translated_text }}</pre>
    </div>
    
    <div class="result-actions">
        <button 
            type="button" 
            class="btn btn-secondary btn-sm"
            onclick="copyToClipboard('{{ translated_text|escapejs }}')"
        >
            ğŸ“‹ è¤‡è£½
        </button>
        <span class="request-id text-secondary">
            ID: {{ request_id }}
        </span>
    </div>
</div>

{% elif status == 'queued' %}
<div class="translation-result queued" id="translation-result"
     hx-get="/api/v1/translate/{{ request_id }}/status/"
     hx-trigger="every 2s"
     hx-swap="outerHTML">
    <div class="result-header">
        <span class="status-badge status-queued">â³ æ’éšŠä¸­</span>
        <span class="queue-info">
            ä½ç½®ï¼šç¬¬ <strong>{{ queue_position }}</strong> ä½
        </span>
    </div>
    
    <div class="result-content">
        <div class="loading-indicator">
            <span class="spinner"></span>
            <span>ç³»çµ±ç¹å¿™ï¼Œæ‚¨çš„è«‹æ±‚å·²åŠ å…¥ä½‡åˆ—</span>
        </div>
        <p class="text-secondary">
            é ä¼°ç­‰å¾…æ™‚é–“ï¼š{{ estimated_wait }}ç§’
        </p>
    </div>
</div>

{% elif status == 'processing' %}
<div class="translation-result processing" id="translation-result"
     hx-get="/api/v1/translate/{{ request_id }}/status/"
     hx-trigger="every 2s"
     hx-swap="outerHTML">
    <div class="result-header">
        <span class="status-badge status-processing">ğŸ”„ è™•ç†ä¸­</span>
    </div>
    
    <div class="result-content">
        <div class="loading-indicator">
            <span class="spinner"></span>
            <span>æ­£åœ¨ç¿»è­¯æ‚¨çš„æ–‡å­—...</span>
        </div>
    </div>
</div>

{% elif status == 'error' %}
<div class="translation-result error" id="translation-result">
    <div class="result-header">
        <span class="status-badge status-error">âœ— éŒ¯èª¤</span>
        <span class="error-code">{{ error_code }}</span>
    </div>
    
    <div class="result-content">
        <p class="error-message">{{ error_message }}</p>
        {% if error_details %}
        <details class="error-details">
            <summary>è©³ç´°è³‡è¨Š</summary>
            <pre>{{ error_details }}</pre>
        </details>
        {% endif %}
    </div>
    
    <div class="result-actions">
        <button 
            type="button" 
            class="btn btn-primary btn-sm"
            onclick="retryTranslation()"
        >
            ğŸ”„ é‡è©¦
        </button>
    </div>
</div>

{% else %}
<div class="translation-result empty" id="translation-result">
    <p class="placeholder-text">ç¿»è­¯çµæœå°‡é¡¯ç¤ºåœ¨é€™è£¡...</p>
</div>
{% endif %}

<style>
.translation-result {
    border: 1px solid var(--border-color, #e0e0e0);
    border-radius: 8px;
    padding: 16px;
    background-color: var(--surface-color, #ffffff);
}

.translation-result.success {
    border-color: var(--success-color, #28a745);
}

.translation-result.error {
    border-color: var(--error-color, #dc3545);
    background-color: #fff8f8;
}

.translation-result.queued,
.translation-result.processing {
    border-color: var(--warning-color, #ffc107);
    background-color: #fffdf5;
}

.result-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border-color, #e0e0e0);
}

.status-badge {
    padding: 4px 12px;
    border-radius: 16px;
    font-size: 0.875rem;
    font-weight: 500;
}

.status-completed {
    background-color: #d4edda;
    color: #155724;
}

.status-queued {
    background-color: #fff3cd;
    color: #856404;
}

.status-processing {
    background-color: #cce5ff;
    color: #004085;
}

.status-error {
    background-color: #f8d7da;
    color: #721c24;
}

.result-content {
    margin: 12px 0;
}

.translated-text {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-family: inherit;
    font-size: 1rem;
    line-height: 1.6;
    margin: 0;
    padding: 0;
    background: transparent;
    border: none;
}

.result-actions {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 12px;
    padding-top: 8px;
    border-top: 1px solid var(--border-color, #e0e0e0);
}

.loading-indicator {
    display: flex;
    align-items: center;
    gap: 12px;
}

.error-message {
    color: var(--error-color, #dc3545);
    font-weight: 500;
}

.error-details {
    margin-top: 8px;
}

.error-details summary {
    cursor: pointer;
    color: var(--text-secondary, #666);
}

.error-details pre {
    margin-top: 8px;
    padding: 12px;
    background-color: #f5f5f5;
    border-radius: 4px;
    font-size: 0.875rem;
    overflow-x: auto;
}

.placeholder-text {
    color: var(--text-secondary, #999);
    text-align: center;
    padding: 24px;
}

.detected-info {
    font-size: 0.875rem;
    color: var(--text-secondary, #666);
}

.confidence {
    opacity: 0.8;
}

.request-id {
    font-size: 0.75rem;
}
</style>

<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        // é¡¯ç¤ºæˆåŠŸæç¤º
        showToast('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼', 'success');
    }).catch(function(err) {
        console.error('è¤‡è£½å¤±æ•—:', err);
        showToast('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–è¤‡è£½', 'error');
    });
}

function retryTranslation() {
    // è§¸ç™¼é‡æ–°ç¿»è­¯
    if (typeof Alpine !== 'undefined') {
        const app = document.querySelector('[x-data]');
        if (app && app.__x) {
            app.__x.$data.translate();
        }
    }
}

function showToast(message, type) {
    // ç°¡å–®çš„æç¤ºè¨Šæ¯
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.textContent = message;
    toast.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 12px 24px;
        border-radius: 8px;
        color: white;
        z-index: 9999;
        animation: fadeIn 0.3s ease;
        background-color: ${type === 'success' ? '#28a745' : '#dc3545'};
    `;
    document.body.appendChild(toast);
    
    setTimeout(function() {
        toast.style.animation = 'fadeOut 0.3s ease';
        setTimeout(function() {
            toast.remove();
        }, 300);
    }, 2000);
}
</script>
