{% extends 'translator/base.html' %}

{% block title %}設定 - 多國語言翻譯系統{% endblock %}

{% block content %}
<div x-data="settingsApp()">
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">偏好設定</h2>
        </div>
        
        <!-- 語言設定 -->
        <div class="settings-section" style="margin-bottom: 24px;">
            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 12px;">預設語言</h3>
            
            <div class="form-group">
                <label for="default-source-lang" class="form-label">預設來源語言</label>
                <select 
                    id="default-source-lang" 
                    class="form-control"
                    x-model="settings.defaultSourceLang"
                    @change="saveSettings"
                    style="max-width: 300px;"
                >
                    <option value="auto">自動偵測</option>
                    {% for lang in languages %}
                    <option value="{{ lang.code }}">{{ lang.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="default-target-lang" class="form-label">預設目標語言</label>
                <select 
                    id="default-target-lang" 
                    class="form-control"
                    x-model="settings.defaultTargetLang"
                    @change="saveSettings"
                    style="max-width: 300px;"
                >
                    {% for lang in languages %}
                    <option value="{{ lang.code }}">{{ lang.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <!-- 翻譯品質 -->
        <div class="settings-section" style="margin-bottom: 24px;">
            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 12px;">翻譯品質</h3>
            
            <div class="form-group">
                <label class="form-label">品質模式</label>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input 
                            type="radio" 
                            name="quality" 
                            value="fast"
                            x-model="settings.quality"
                            @change="saveSettings"
                        >
                        <span><strong>快速模式</strong> - 較快的回應速度，適合簡短文字</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input 
                            type="radio" 
                            name="quality" 
                            value="standard"
                            x-model="settings.quality"
                            @change="saveSettings"
                        >
                        <span><strong>標準模式</strong> - 平衡速度與品質（建議）</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input 
                            type="radio" 
                            name="quality" 
                            value="quality"
                            x-model="settings.quality"
                            @change="saveSettings"
                        >
                        <span><strong>高品質模式</strong> - 更精確的翻譯，處理時間較長</span>
                    </label>
                </div>
            </div>
        </div>
        
        <!-- 介面設定 -->
        <div class="settings-section" style="margin-bottom: 24px;">
            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 12px;">介面設定</h3>
            
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input 
                        type="checkbox" 
                        x-model="settings.autoDetect"
                        @change="saveSettings"
                    >
                    <span>啟用自動語言偵測</span>
                </label>
            </div>
            
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input 
                        type="checkbox" 
                        x-model="settings.saveHistory"
                        @change="saveSettings"
                    >
                    <span>儲存翻譯歷史記錄</span>
                </label>
            </div>
            
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input 
                        type="checkbox" 
                        x-model="settings.showConfidence"
                        @change="saveSettings"
                    >
                    <span>顯示語言偵測信心度</span>
                </label>
            </div>
        </div>
        
        <!-- 動作按鈕 -->
        <div class="settings-actions" style="display: flex; gap: 12px; padding-top: 16px; border-top: 1px solid var(--border-color);">
            <button 
                type="button" 
                class="btn btn-secondary"
                @click="resetSettings"
            >
                還原預設值
            </button>
            <span x-show="saved" x-transition style="color: var(--success-color); display: flex; align-items: center; gap: 4px;">
                ✓ 設定已儲存
            </span>
        </div>
    </div>
    
    <!-- 快捷鍵說明 -->
    <div class="card" style="margin-top: 20px;">
        <div class="card-header">
            <h2 class="card-title">鍵盤快捷鍵</h2>
        </div>
        
        <div class="shortcuts-list">
            <div style="display: grid; gap: 8px;">
                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                    <span>執行翻譯</span>
                    <kbd style="background: var(--bg-secondary); padding: 2px 8px; border-radius: 4px; font-family: monospace;">Ctrl + Enter</kbd>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                    <span>複製翻譯結果</span>
                    <kbd style="background: var(--bg-secondary); padding: 2px 8px; border-radius: 4px; font-family: monospace;">Ctrl + Shift + C</kbd>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                    <span>關閉錯誤訊息</span>
                    <kbd style="background: var(--bg-secondary); padding: 2px 8px; border-radius: 4px; font-family: monospace;">Esc</kbd>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function settingsApp() {
    return {
        settings: {
            defaultSourceLang: 'auto',
            defaultTargetLang: 'en',
            quality: 'standard',
            autoDetect: true,
            saveHistory: true,
            showConfidence: true,
        },
        saved: false,
        
        init() {
            this.loadSettings();
        },
        
        loadSettings() {
            try {
                const stored = JSON.parse(sessionStorage.getItem('userSettings') || '{}');
                this.settings = { ...this.settings, ...stored };
            } catch (e) {
                console.error('載入設定失敗:', e);
            }
        },
        
        saveSettings() {
            try {
                sessionStorage.setItem('userSettings', JSON.stringify(this.settings));
                // 同步品質設定
                sessionStorage.setItem('quality', this.settings.quality);
                
                this.saved = true;
                setTimeout(() => {
                    this.saved = false;
                }, 2000);
            } catch (e) {
                console.error('儲存設定失敗:', e);
            }
        },
        
        resetSettings() {
            if (confirm('確定要還原所有設定為預設值嗎？')) {
                this.settings = {
                    defaultSourceLang: 'auto',
                    defaultTargetLang: 'en',
                    quality: 'standard',
                    autoDetect: true,
                    saveHistory: true,
                    showConfidence: true,
                };
                this.saveSettings();
            }
        }
    };
}
</script>
{% endblock %}
